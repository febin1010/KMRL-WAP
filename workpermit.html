<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kochi Metro - Work Access Permit</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <link rel="stylesheet" href="workpermitstyle.css">


</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-bg"></div>
            <div class="header-content">
                <img src="KMRL-logo.png" alt="Kochi Metro Logo" class="logo">
                <div class="header-title">
                    <h1>KOCHI METRO RAIL LTD</h1>
                    <h2>Work Access Permit</h2>
                </div>
            </div>
        </div>

        <form class="form-container">
            <h3 class="section-title">PART-1: Request for Work in KMRL</h3>
            <p style="color: var(--text-light); font-size: 0.9rem">(To be submitted at least 24 hrs prior to work)</p>

            <div class="form-grid">
                <div class="form-group span-2">
                    <label for="licensee">Name of Licensee</label>
                    <input type="text" id="licensee" required>
                </div>

                <div class="form-group">
                    <label for="loa">LOA NO.</label>
                    <input type="text" id="loa" required>
                </div>

                <div class="form-group">
                    <label for="office_no">Office No.</label>
                    <input type="tel" id="office_no" required>
                </div>

                <div class="form-group span-2">
                    <label for="official">Name & Designation of Official</label>
                    <input type="text" id="official" required>
                </div>

                <div class="form-group">
                    <label for="official_mobile">Mobile Phone No.</label>
                    <input type="tel" id="official_mobile" required>
                </div>

                <div class="form-group">
                    <label for="scope">Scope of Business</label>
                    <input type="text" id="scope" required>
                </div>

                <div class="form-group">
                    <label for="station">Proposed Station</label>
                    <input type="text" id="station" required>
                </div>

                <div class="form-group">
                    <label for="location">Proposed Location</label>
                    <input type="text" id="location" required>
                </div>

                <div class="form-group span-3">
                    <label for="description">Description of Civil Work</label>
                    <textarea id="description" rows="4" required></textarea>
                </div>

                <div class="form-group span-2">
                    <label for="duration">Proposed Date / No. of days</label>
                    <input type="text" id="duration" required>
                </div>

                <div class="form-group">
                    <label for="tools">Details of tools</label>
                    <input type="text" id="tools" required>
                </div>

                <div class="form-group">
                    <label for="competent_sup">Name of Competent Supervisor</label>
                    <input type="text" id="competent_sup" required>
                </div>

                <div class="form-group">
                    <label for="competent_eng">Name of Competent Engineer</label>
                    <input type="text" id="competent_eng" required>
                </div>

                <div class="form-group">
                    <label for="eng_mobile">Engineer Mobile No.</label>
                    <input type="tel" id="eng_mobile" required>
                </div>

                <div class="form-group">
                    <label for="workers">No. of workers</label>
                    <input type="number" id="workers" required>
                </div>

                <div class="form-group span-2">
                    <label for="attachments">Copy of IDs attached</label>
                    <input type="file" id="attachments" multiple accept=".pdf,.jpg,.jpeg,.png" required>
                </div>
            </div>

            <div class="declaration-section">
                <h3 class="section-title">Declaration</h3>
                <p class="declaration-text">
                    I, on behalf of the above firm, hereby take the full responsibility of the proposed works and also the safety of our workers, supervisors and the people who could be affected due to works. Certified that the deputed workforce is qualified and competent for the assigned job with personal protection equipment (PPE to be arranged by the vendor). Read and accepted the "Instructions to the vendor" mentioned at Annexure-1.
                </p>
                
                <p class="declaration-text">
                    The request for work as above has been verified with the conditions of contract. May be permitted to take up works by the Authorized representative with Emp No. & Desg. with duly following the takeover work area & supervising process.
                </p>

                <div class="authorized-entry">
                    <div class="form-group">
                        <label for="auth_name1">Name & Designation of Authorized Representative 1</label>
                        <input type="text" id="auth_name1" required placeholder="Name - Designation">
                    </div>
                    <div class="form-group">
                        <label for="auth_name2">Name & Designation of Authorized Representative 2</label>
                        <input type="text" id="auth_name2" required placeholder="Name - Designation">
                    </div>
                </div>

                <div class="work-type-selection">
                    <span>As per the extant rule of:</span>
                    <label class="work-type-label">
                        <input type="checkbox" name="workMode" value="wap"> WAP
                    </label>
                    <label class="work-type-label">
                        <input type="checkbox" name="workMode" value="jobCard"> JOB CARD
                    </label>
                </div>
            </div>

            <div class="signature-area">
                <div class="signature-box">
                    <div class="signature-line"></div>
                    <label>Signature of KMRL contract manager</label>
                </div>
                <div class="signature-box">
                    <div class="signature-line"></div>
                    <label>NAME</label>
                </div>
                <div class="signature-box">
                    <div class="signature-line"></div>
                    <label>DEPARTMENT</label>
                </div>
            </div>

            <div class="form-footer">
                <div>
                    <h3>Kochi Metro Rail LTD</h3>
                    <p>O&M Division</p>
                </div>
                <button type="submit">Submit Application</button>
            </div>
        </form>
    </div>

    <script>
        // Form Validation
        const inputs = document.querySelectorAll('input, textarea, select');
        const excludedFields = ['scope_of_business', 'loa_no', 'office_no', 'details_of_tools'];
    
        inputs.forEach(input => {
            input.addEventListener('blur', (e) => {
                const formGroup = e.target.closest('.form-group');
                if (!formGroup) return; // Prevents error if no .form-group exists
    
                if (e.target.required && e.target.value.trim() === '' && !excludedFields.includes(e.target.name)) {
                    formGroup.classList.add('invalid');
                    formGroup.classList.remove('valid');
    
                    if (!formGroup.querySelector('.validation-message')) {
                        const message = document.createElement('div');
                        message.className = 'validation-message';
                        message.textContent = 'This field is required';
                        formGroup.appendChild(message);
                    }
                } else {
                    formGroup.classList.remove('invalid');
                    formGroup.classList.add('valid');
                    const validationMessage = formGroup.querySelector('.validation-message');
                    if (validationMessage) validationMessage.remove();
                }
            });
    
            input.addEventListener('focus', (e) => {
                const formGroup = e.target.closest('.form-group');
                if (formGroup) formGroup.classList.add('focused'); // Ensures formGroup exists
            });
        });
    
        // Smooth Scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetElement = document.querySelector(this.getAttribute('href'));
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });
    
        // Form Submission
        document.querySelector("form").addEventListener("submit", function (e) {
            e.preventDefault();
    
            let formData = new FormData(this);
    
            fetch("submit_work_permit.php", {
                method: "POST",
                body: formData
            })
            .then(response => response.text()) // First, get the response as text
            .then(text => {
                try {
                    return JSON.parse(text); // Try parsing JSON
                } catch (error) {
                    console.error("Invalid JSON response:", text); // Log if not JSON
                    throw new Error("Server returned invalid response.");
                }
            })
            .then(data => {
                alert(data.message);
                if (data.status === "success") {
                    document.querySelector("form").reset();
                }
            })
            .catch(error => console.error("Error:", error));
        });
    
        // Signature Box Interaction
        document.querySelectorAll('.signature-box').forEach(box => {
            box.addEventListener('click', () => {
                box.style.transform = 'scale(1.02)';
                setTimeout(() => {
                    box.style.transform = 'translateY(-4px)';
                }, 200);
            });
        });
    </script>
    

</body>
</html>